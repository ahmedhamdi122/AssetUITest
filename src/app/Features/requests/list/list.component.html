<div class="col-12">
    <div class="row top-buffer">
        <div class="col-8">
            <h4 class="card-title" *ngIf="showSR"> {{ 'Asset.Requests' | translate }} </h4>
            <h4 class="card-title" *ngIf="showIncomeSR"> {{'Asset.IncomeRequests' |translate}}</h4>
        </div>
        <div class="col-2"> <a class="addbutton" *ngIf="isAssetOwner || isSRCreator" (click)="addRequest()">
                <i class="fa-solid fa-plus"></i> {{'Asset.Create'|translate }}</a>
        </div>
        <div class="col-2">
            <a data-toggle="collapse" href="#collapseExample" role="button" aria-expanded="true"
                aria-controls="collapseExample" class="filterbutton">
                <i class="fa-solid fa-filter"></i> {{'Asset.Filter'|translate}}</a>
        </div>
    </div>
    <div class="row top-buffer">
        <div class="col-10">
            <button mat-stroked-button name="btnAll" [matBadge]="countAll" (click)="getRequestsByStatusId(0,$event)"
                style="margin: 0px 15px;">{{'Asset.All'
                |translate}}</button>

            <mat-nav-list id="app-nav" aria-label="Main navigation" *ngFor="let sts of lstMainStatuses">
                <a mat-list-item *ngIf=" sts.id==1" (click)="getRequestsByStatusId(sts.id,$event)" mat-stroked-button
                    [ngStyle]="{'color': sts.color}" autofocus [matBadge]="countOpen">
                    <span mat-line>
                        <span><i [ngClass]="sts.icon"></i></span>
                        {{lang=="en"?sts.name:sts.nameAr}}
                    </span>
                </a>
                <a mat-list-item *ngIf=" sts.id==2" (click)="getRequestsByStatusId(sts.id,$event)" mat-stroked-button
                    [ngStyle]="{'color': sts.color}" [matBadge]="countClosed">
                    <span mat-line>
                        <span><i [ngClass]="sts.icon"></i></span>
                        {{lang=="en"?sts.name:sts.nameAr}}
                    </span>
                </a>
                <a mat-list-item *ngIf=" sts.id==3" (click)="getRequestsByStatusId(sts.id,$event)" mat-stroked-button
                    [ngStyle]="{'color': sts.color}" [matBadge]="countInProgress">
                    <span mat-line>
                        <span><i [ngClass]="sts.icon"></i></span>
                        {{lang=="en"?sts.name:sts.nameAr}}
                    </span>
                </a>
                <a mat-list-item *ngIf=" sts.id==4" (click)="getRequestsByStatusId(sts.id,$event)" mat-stroked-button
                    [ngStyle]="{'color': sts.color}" [matBadge]="countSolved">
                    <span mat-line>
                        <span><i [ngClass]="sts.icon"></i></span>
                        {{lang=="en"?sts.name:sts.nameAr}}
                    </span>
                </a>
                <a mat-list-item *ngIf=" sts.id==5" (click)="getRequestsByStatusId(sts.id,$event)" mat-stroked-button
                    [ngStyle]="{'color': sts.color}" [matBadge]="countApproved">
                    <span mat-line>
                        <span><i [ngClass]="sts.icon"></i></span>
                        {{lang=="en"?sts.name:sts.nameAr}}
                    </span>
                </a>
                <a mat-list-item *ngIf=" sts.id>5" (click)="getRequestsByStatusId(sts.id,$event)" mat-stroked-button
                    [ngStyle]="{'color': sts.color}" [matBadge]="countClosed">
                    <span mat-line>
                        <span><i [ngClass]="sts.icon"></i></span>
                        {{lang=="en"?sts.name:sts.nameAr}}
                    </span>
                </a>
            </mat-nav-list>
        </div>
        <div class="col-2">
            <button type="button" class="btn excelIcon" (click)="exportExcel()"><i
                    class="fa-solid fa-file-excel fa-2xl"></i></button>
            <button type="button" class="btn excelIcon" (click)="printSelectedColumns()"><i
                    class="fa-solid fa-columns fa-2xl"></i></button>
            <button type="button" class="btn pdfIcon" (click)="generatePDF()"><i
                    class="fa-solid fa-file-pdf fa-2xl"></i></button>
        </div>
    </div>
    <div class="row top-buffer"></div>
    <div class="col-12">
        <div id="collapseExample" class="collapse row card-filter">
            <form (ngSubmit)="onSearch()" #searchForm="ngForm">
                <div class="row top-buffer">
                    <div class="col-2">
                        <label for="governorate" [translate]="'Asset.Governorates'">Governorate</label>
                        <select class="form-control" id="governorate" name="governorate" #governorate="ngModel"
                            [value]="0" [(ngModel)]="sortFilterObjects.searchObj.governorateId" [disabled]="isGov"
                            (change)="getCitiesByGovId(sortFilterObjects.searchObj.governorateId)">
                            <option value="0"></option>
                            <option *ngFor="let gov of lstGovernorates" [value]="gov.id">
                                {{ lang == "en" ? gov.name : gov.nameAr }}
                            </option>
                        </select>
                    </div>
                    <div class="col-2">
                        <label for="cityId" [translate]="'Asset.Cities'">City</label>
                        <select class="form-control" id="city" name="city" #cityId="ngModel"
                            [(ngModel)]="sortFilterObjects.searchObj.cityId" [value]="0" [disabled]="isCity">
                            <option value="0"> </option>
                            <option *ngFor="let city of lstCities" [value]="city.id">
                                {{ lang == "en" ? city.name : city.nameAr }}
                            </option>
                        </select>
                    </div>
                    <div class="col-2">
                        <label for="organization" [translate]="'Asset.Organizations'">Organization</label>
                        <select class="form-control" id="organization" [disabled]="isOrg" name="organization"
                            [(ngModel)]="sortFilterObjects.searchObj.organizationId" (change)="getSubOrgByOrgId($event)"
                            [value]="0">
                            <option value="0"></option>
                            <option *ngFor="let org of lstOrganizations" [value]="org.id">
                                {{ lang == "en" ? org.name : org.nameAr }}
                            </option>
                        </select>
                    </div>
                    <div class="col-2">
                        <label for="organization" [translate]="'Asset.SubOrganizations'">Sub Organization</label>
                        <select class="form-control" id="suborganization" name="suborganization" [value]="0"
                            [disabled]="isSubOrg" (change)="getHospitalsBySubOrgId()"
                            [(ngModel)]="sortFilterObjects.searchObj.subOrganizationId" #suborganization="ngModel">
                            <option value="0"></option>
                            <option *ngFor="let suborg of lstSubOrganizations" [value]="suborg.id">
                                {{ lang == "en" ? suborg.name : suborg.nameAr }}
                            </option>
                        </select>
                    </div>
                    <div class="col-2">
                        <label for="hospital" [translate]="'Asset.Hospitals'">Hospitals</label>
                        <select class="form-control" id="hospital" [disabled]="isHospital" name="hospital"
                            [(ngModel)]="sortFilterObjects.searchObj.hospitalId" [value]="0"
                            (change)="getAssetsByHospitalId($event)">
                            <option value="0"></option>
                            <option *ngFor="let host of lstHospitals" [value]="host.id">
                                {{ lang == "en" ? host.name : host.nameAr }}
                            </option>
                        </select>
                    </div>
                    <div class="col-2">
                        <label for="assetName" [translate]="'Asset.Name'"></label>
                        <p-autoComplete [suggestions]="lstMasterAssets" type="search" name="masterAssetId"
                            id="masterAssetId" (completeMethod)="onMasterSelectionChanged($event)"
                            (onSelect)="getMasterObject($event)" field="name" [dropdown]="false">
                            <ng-template let-masterAssetObj pTemplate="item">
                                {{lang ==="en" ? masterAssetObj.name:masterAssetObj.nameAr}} -
                                {{lang ==="en" ? masterAssetObj.brandName:masterAssetObj.brandNameAr}}
                                - {{masterAssetObj.model}}
                            </ng-template>
                            <ng-template let-masterAssetObj pTemplate="selectedItem">
                                {{lang=="en" ?masterAssetObj.name:masterAssetObj.nameAr}} -
                                {{lang ==="en" ? masterAssetObj.brandName:masterAssetObj.brandNameAr}}
                                - {{masterAssetObj.model}}
                            </ng-template>
                        </p-autoComplete>
                    </div>
                </div>
                <div class="row top-buffer">
                    <div class="col-2">
                        <label for="subject" [translate]="'Asset.Subject'"></label>
                        <input type="text" class="form-control" [(ngModel)]="sortFilterObjects.searchObj.subject"
                            [ngModelOptions]="{standalone: true}" />
                    </div>
                    <div class="col-2">
                        <label for="code" [translate]="'Asset.RequestCode'"></label>
                        <input type="text" class="form-control" [(ngModel)]="sortFilterObjects.searchObj.code"
                            [ngModelOptions]="{standalone: true}" />
                    </div>

                    <div class="col-2">
                        <label for="barcode" [translate]="'Asset.Barcode'"> </label>
                        <p-autoComplete [(ngModel)]="assetBarCodeObj" [ngModelOptions]="{standalone: true}"
                            [suggestions]="lstassetDetailBarcodes" name="barcode" id="barcode" autoWidth="true"
                            (completeMethod)="onSelectionChanged($event)" (onSelect)="getBarCode($event)" field="name"
                            [dropdown]="false" showClear="true">
                            <ng-template let-assetBarCodeObj pTemplate="item">
                                {{assetBarCodeObj.barCode}}
                            </ng-template>
                            <ng-template let-assetBarCodeObj pTemplate="selectedItem">
                                {{assetBarCodeObj.barCode}}
                            </ng-template>
                        </p-autoComplete>
                    </div>
                    <div class="col-2">
                        <label for="serialNumber" [translate]="'Asset.Serial'"></label>
                        <p-autoComplete [(ngModel)]="assetSerailNumberObj" [ngModelOptions]="{standalone: true}"
                            [suggestions]="lstAssetSerailNumberObj" name="serial" id="serial" autoWidth="true"
                            (completeMethod)="onSerialNumberSelectionChanged($event)"
                            (onSelect)="getSerialNumber($event)" field="name" [dropdown]="false" showClear="true">
                            <ng-template let-assetSerailNumberObj pTemplate="item">
                                {{assetSerailNumberObj.serialNumber}}
                            </ng-template>
                            <ng-template let-assetSerailNumberObj pTemplate="selectedItem">
                                {{assetSerailNumberObj.serialNumber}}
                            </ng-template>
                        </p-autoComplete>
                    </div>
                    <div class="col-2">
                        <label for="modelNumber" [translate]="'Asset.Model'"></label>
                        <input type="text" class="form-control" [(ngModel)]="sortFilterObjects.searchObj.modelNumber"
                            [ngModelOptions]="{standalone: true}" />
                    </div>
                    <div class="col-2">
                        <label for="periorityId" [translate]="'Asset.Periority'"></label>
                        <select class="form-control" id="periorityId" [ngModelOptions]="{standalone: true}"
                            name="periorityId" [(ngModel)]="sortFilterObjects.searchObj.periorityId" [value]="0">
                            <option value="0"></option>
                            <option *ngFor="let prty of lstPeriorities" [value]="prty.id">
                                {{ lang == "en" ? prty.name : prty.nameAr }}
                            </option>
                        </select>
                    </div>
                </div>
                <div class="row top-buffer">
                    <div class="col-2">
                        <label for="modeId" [translate]="'Asset.Mode'"></label>
                        <select class="form-control" id="modeId" name="modeId" name="modeId"
                            [(ngModel)]="sortFilterObjects.searchObj.modeId" [value]="0"
                            [ngModelOptions]="{standalone: true}">
                            <option value="0"></option>
                            <option *ngFor="let mode of lstModes" [value]="mode.id">
                                {{ lang == "en" ? mode.name : mode.nameAr }}
                            </option>
                        </select>
                    </div>
                    <div class="col-2">
                        <label for="departmentId" [translate]="'Asset.Departments'">Departments</label>
                        <select class="form-control" id="departmentId" name="departmentId"
                            [(ngModel)]="sortFilterObjects.searchObj.departmentId" [value]="0">
                            <option value="0"></option>
                            <option *ngFor="let depart of lstDepartments" [value]="depart.id">
                                {{ lang == "en" ? depart.name : depart.nameAr }}
                            </option>
                        </select>
                    </div>
                    <div class="col-2">
                        <label for="subject"> {{'Asset.StartDate' | translate }}</label>
                        <input type="date" class="form-control" [(ngModel)]="sortFilterObjects.searchObj.start"
                            [ngModelOptions]="{standalone: true}" />
                    </div>
                    <div class="col-2">
                        <label for="endDate" [translate]="'Asset.EndDate'"> {{'Asset.EndDate' | translate }}</label>
                        <input type="date" class="form-control" [(ngModel)]="sortFilterObjects.searchObj.end"
                            [ngModelOptions]="{standalone: true}" />
                    </div>
                    <div class="col-2"></div>
                    <div class="col-1"> <button class="btn searchIcon" value="save" type="submit">
                            <i class="fa-solid fa-magnifying-glass fa-2xl"></i>
                        </button></div>
                    <div class="col-1"> <button class="btn reset" value="Reset" type="button" (click)="clearSearch()">
                            <i class="fa-solid fa-circle-xmark  fa-2xl"></i>
                        </button></div>
                </div>
            </form>
        </div>
    </div>

    <div class="row">
        <div class="col-12">
            <p-table [value]="lstRequests" name="requestTbl"
                styleClass="p-datatable-striped p-datatable-sm p-datatable-gridlines" responsiveLayout="scroll"
                [paginator]="true" [lazy]="true" [rows]="10" [totalRecords]="count" pageLinks="10" [rowHover]="true"
                (onLazyLoad)="clicktbl($event)" [loading]="loading" [columns]="selectedColumns">
                <ng-template pTemplate="caption">
                    <p-multiSelect [options]="cols" name="ddlCols" [(ngModel)]="selectedColumns" optionLabel="header"
                        selectedItemsLabel="{0} {{columnsSelected}}" [style]="{minWidth: '200px'}"
                        [placeholder]="'Asset.ChooseColumns' |translate">
                    </p-multiSelect>
                </ng-template>
                <ng-template pTemplate="header" let-cols>
                    <tr>
                        <th></th>
                        <th style="text-align: inherit;display: none;"></th>
                        <th style="text-align: inherit;width: 500px;" [sortable]="true" *ngFor="let col of cols">
                            {{col.header}}
                            <p-sortIcon id="{{col.header | translate}}" (click)="sort($event)">
                            </p-sortIcon>
                        </th>

                        <th>{{'Asset.Actions' | translate }}</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-item let-columns="columns">
                    <tr>
                        <td style="text-align: inherit;display: none;">
                            <ngx-barcode [bc-value]="item.requestCode" id="barcode_{{item.id}}" class="barcode"
                                [bc-display-value]="true" width="20" height="10" [bc-element-type]="elementType">
                            </ngx-barcode>
                        </td>
                        <td style="text-align: inherit;">
                            <mat-checkbox id="ckbx{{item.id}}" name="ckbx{{item.id}}"
                                (change)="checkedRequest($event, item.id)" [value]="item.id">
                            </mat-checkbox>
                        </td>
                        <ng-container *ngFor="let col of columns">
                            <td style="text-align: inherit;"
                                *ngIf="col.field !='woLastTrackDescription' && col.field !='requestDate' && col.field !== 'statusName' && col.field !== 'statusNameAr' && col.field !=='createdBy' && col.field !=='closedDate'
                                     && col.field !== 'periorityName'  && col.field !== 'periorityNameAr' && col.field !='assetName' && col.field !='assetNameAr' && col.field !=='description' && col.field !=='modelNumber'">
                                {{item[col.field]}}
                            </td>
                            <td style="text-align: inherit;" *ngIf="col.field=='requestDate'">
                                {{item.requestDate | date:'dd-MM-yyyy HH:mm'}}
                            </td>
                            <td *ngIf="col.field=='assetName'" [frozen]="true">
                                <a [routerLink]="['/dash/hospitalassets/detail/',item.assetDetailId]">{{lang=="en" ?
                                    item.assetName:item.assetNameAr}}
                                </a>
                            </td>
                            <td style="text-align: inherit;" *ngIf="col.field=='assetNameAr'">
                                <a [routerLink]="['/dash/hospitalassets/detail/',item.assetDetailId]">{{lang=="en" ?
                                    item.assetName:item.assetNameAr}}
                                </a>
                            </td>
                            <td style="text-align: inherit;" *ngIf="col.field =='statusNameAr'">
                                <span [ngStyle]="{'color':item.statusColor}">
                                    <span><i [ngClass]="item.statusIcon"></i></span>
                                    {{lang=="en" ? item.statusName:item.statusNameAr}}
                                </span>
                            </td>
                            <td style="text-align: inherit;" *ngIf="col.field =='modelNumber'">
                                {{item.modelNumber}}
                            </td>

                            <td style="text-align: inherit;width:500px" *ngIf="col.field =='statusName'">
                                <span [ngStyle]="{'color':item.statusColor}">
                                    <span><i [ngClass]="item.statusIcon"></i></span>
                                    {{lang=="en" ? item.statusName:item.statusNameAr}}
                                </span>
                            </td>
                            <td style="text-align: inherit;" *ngIf="col.field =='periorityName'">
                                <i [ngClass]="item.periorityIcon" [ngStyle]="{'color': item.periorityColor}"></i>
                                {{lang=="en" ? item.periorityName: item.periorityNameAr}}
                            </td>
                            <td style="text-align: inherit;" *ngIf="col.field =='createdBy'">
                                {{item.createdBy}}
                            </td>
                            <td style="text-align: inherit;" *ngIf="col.field =='closedDate'">
                                {{item.closedDate}}
                            </td>

                            <td style="text-align: inherit;" *ngIf="col.field =='description'">
                                {{item.description}}
                            </td>

                            <td style="text-align: inherit;" *ngIf="col.field =='woLastTrackDescription'">
                                {{item.woLastTrackDescription}}
                            </td>

                            <td style="text-align: inherit;" *ngIf="col.field =='periorityNameAr'">
                                <i [ngClass]="item.periorityIcon" [ngStyle]="{'color': item.periorityColor}"></i>
                                {{lang=="en" ? item.periorityName: item.periorityNameAr}}
                            </td>
                        </ng-container>
                        <td style="text-align: inherit;">
                            <span class="viewIcon" (click)="viewRequest(item.id)">
                                <i class="fa-solid fa-eye"></i>
                            </span>
                            <span class="editIcon"
                                *ngIf="(isSRCreator || isAssetOwner || isSRCreator) &&  (item.countWorkOrder == 0)"
                                (click)="editRequest(item.id)">
                                <i class="fa-solid fa-edit"></i>
                            </span>
                            <span class="deleteIcon"
                                *ngIf="(isAssetOwner  || isSRCreator) &&  (item.countWorkOrder == 0)"
                                (click)="deleteRequest(item.id)">
                                <i class="fa-solid fa-trash"></i>
                            </span>
                            <span (click)="ApproveRequest(item.id)"
                                *ngIf="(isAssetOwner || isSRReviewer) && (item.latestWorkOrderStatusId == 11  && item.statusId ==4) ">
                                <i class="fa-solid fa-thumbs-up" style="color: #0d4f28;margin: 0px 5px;"></i>
                            </span>

                            <span pTooltip="{{'Asset.Reviewed'| translate}}" tooltipPosition="top"
                                *ngIf="(isSRCreator || isAssetOwner || isSRReviewer) && item.statusId == 5">
                                <i class="fa-solid fa-check-double" style="color: #0d4f28;margin: 0px 5px;"></i>
                            </span>

                            <span pTooltip="{{'Asset.ReAssign'| translate}}" tooltipPosition="top"
                                *ngIf="isAssetOwner && (item.latestWorkOrderStatusId == 9)">
                                <i class="fa-solid fa-redo" style="color: #0d4f28;margin: 0px 5px;"></i>
                            </span>
                            <span pTooltip="{{'Asset.AddWorkOrder'| translate}}" tooltipPosition="top"
                                (click)="addWorkOrder(item.id)" *ngIf="isEngManager && item.countWorkOrder == 0">
                                <i class="fa-solid fa-clipboard-list"
                                    style="color: #55595e; cursor: pointer;margin: 0px 5px;"></i>
                            </span>
                            <span pTooltip="{{'Asset.Print'| translate}}" tooltipPosition="top"
                                (click)="printRequest(item.id)" *ngIf="isAssetOwner || isSRCreator || isSRReviewer">
                                <i class="fa-solid fa-print"
                                    style="color: #052e55;margin: 0px 5px;cursor: pointer;"></i>
                            </span>
                        </td>
                    </tr>
                </ng-template>
            </p-table>
        </div>
    </div>

</div>
<p-dialog appendTo="body" modal="true" [(visible)]="errorDisplay" [style]="{ width: '350px' }">
    <p-header style="color: rgb(181, 4, 4)"> {{ 'Asset.Error' | translate }} </p-header>
    <span style="color: rgb(181, 4, 4); font-weight: bold">
        {{ errorMessage }}</span>
</p-dialog>


<p-confirmDialog header="Are you sure you want to delete this item?" appendTo="body">
</p-confirmDialog>